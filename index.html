<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Employee Management System</title>
    <link rel="stylesheet" href="assets/tailwind.css?v=20251005-01" />
    <link rel="stylesheet" href="styles.css?v=20251005-14" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
        <style id="sidebar-toggle-css">
            /* Ensure the sidebar can be collapsed even when Tailwind applies md:flex */
            .sidebar-collapsed #sidebar { display: none !important; }
            .sidebar-collapsed #openSidebarBtn { display: inline-flex !important; }
        </style>
        <style id="ledger-print-styles">
            /* Professional Ledger Print Styles */
            #ledgerPrintArea { display:none; font-family: Inter, Arial, sans-serif; color:#1f2937; }
            #ledgerPrintArea .lp-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:8px; }
            #ledgerPrintArea .lp-brand { font-size:22px; font-weight:800; letter-spacing:.5px; color:#4F46E5; }
            #ledgerPrintArea .lp-meta { font-size:11px; line-height:1.3; text-align:right; color:#475569; }
            #ledgerPrintArea h2 { font-size:18px; font-weight:700; margin:0 0 4px; letter-spacing:.5px; }
            #ledgerPrintArea .lp-range { font-size:12px; margin-bottom:6px; color:#334155; }
            #ledgerPrintArea .lp-summary { font-size:12px; margin:8px 0 12px; padding:6px 10px; background:#F1F5F9; border:1px solid #E2E8F0; border-radius:6px; }
            #ledgerPrintArea table { width:100%; border-collapse:separate; border-spacing:0; font-size:11px; }
            #ledgerPrintArea thead th { background:#EEF2FF; color:#1e293b; font-weight:600; font-size:11px; padding:6px 6px; border:1px solid #e2e8f0; text-align:left; }
            #ledgerPrintArea tbody td { padding:5px 6px; border:1px solid #e2e8f0; vertical-align:top; }
            #ledgerPrintArea tbody tr:nth-child(even) { background:#F8FAFC; }
            #ledgerPrintArea tbody tr.day-total-row { background:#F1F5F9; font-weight:600; }
            #ledgerPrintArea tbody tr.opening-row { background:#E0F2FE; font-weight:600; }
            #ledgerPrintArea tbody tr.grand-total-row { background:#DCFCE7; font-weight:700; }
            #ledgerPrintArea .lp-footer { margin-top:14px; font-size:10px; color:#64748B; display:flex; justify-content:space-between; align-items:center; }
            #ledgerPrintArea .lp-watermark { position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); font-size:64px; font-weight:800; color:rgba(99,102,241,0.06); pointer-events:none; user-select:none; }
            #ledgerPrintArea .mono { font-family: 'SF Mono','Consolas','Courier New',monospace; letter-spacing:-0.25px; }
            @media print {
                /* Show ledger print area */
                #ledgerPrintArea { display:block !important; position:static !important; }
                /* Hide everything else via visibility so nesting doesn't matter */
                body * { visibility:hidden !important; }
                #ledgerPrintArea, #ledgerPrintArea * { visibility:visible !important; }
                @page { size:A4 portrait; margin:12mm; }
                a { color:inherit; text-decoration:none; }
            }
        </style>
                <style id="payroll-print-handler">
                    /* Keep payroll print area hidden on screen; shown only for print */
                    #payrollPrintArea { position: absolute; left: -9999px; top: -9999px; visibility: hidden; display: none; }
                    @media print {
                        #payrollPrintArea { position: static !important; left: auto !important; top: auto !important; visibility: visible !important; display: block !important; }
                    }
                </style>
        <style id="payslip-print-css">
            /* Print-only payslip: hide everything except the payslip area using display none to avoid extra pages */
            @media print {
                /* Only keep the print area in the document flow */
                body > :not(#payslipPrintArea) { display: none !important; }
                #payslipPrintArea { display: block !important; width: 100%; padding: 16mm; margin: 0; }
                /* Page setup for A4 portrait */
                @page { size: A4 portrait; margin: 0; }
                html, body { margin: 0; height: auto; }
                /* Basic styles for slip */
                .payslip { font-family: Inter, Arial, sans-serif; color: #111827; }
                .payslip-header { display:flex; align-items:center; justify-content:space-between; margin-bottom: 12px; }
                .payslip-header .title { font-size: 22px; font-weight: 800; }
                .payslip-header .subtitle { color:#6B7280; font-size: 12px; }
                .payslip-header .brand { font-weight: 700; color:#4F46E5; }
                .payslip-grid { display:grid; grid-template-columns: repeat(3, 1fr); gap: 8px 16px; margin: 8px 0 12px; font-size: 12px; }
                .payslip-grid .label { color:#6B7280; }
                .payslip-grid .value { font-weight: 600; color:#111827; }
                .payslip-table { width:100%; border-collapse: collapse; margin-top: 8px; font-size: 12px; }
                .payslip-table th, .payslip-table td { border: 1px solid #E5E7EB; padding: 6px 8px; }
                .payslip-table thead th { background:#F3F4F6; color:#374151; text-align:left; }
                .payslip-table .total td { font-weight: 800; }
                .payslip-notes { margin-top: 10px; font-size: 12px; }
                .payslip-footer { margin-top: 14px; color:#6B7280; font-size: 11px; text-align:right; }
            }
            /* Screen-only: keep the payslip hidden */
            #payslipPrintArea { display: none; }

            /* Screen styles for payslip preview */
            #payslipPreviewContent { background: #F8FAFC; }
            .payslip { font-family: Inter, Arial, sans-serif; color: #111827; background: #fff; max-width: 900px; margin: 0 auto; border: 1px solid #E5E7EB; border-radius: 12px; padding: 20px; box-shadow: 0 10px 24px rgba(0,0,0,0.06); }
            .payslip-header { display:flex; align-items:center; justify-content:space-between; margin-bottom: 16px; border-bottom: 1px solid #E5E7EB; padding-bottom: 8px; }
            .payslip-header .title { font-size: 20px; font-weight: 800; }
            .payslip-header .subtitle { color:#6B7280; font-size: 12px; }
            .payslip-header .brand { font-weight: 700; color:#4F46E5; }
            .payslip-grid { display:grid; grid-template-columns: repeat(3, 1fr); gap: 8px 16px; margin: 8px 0 12px; font-size: 12px; }
            @media (max-width: 640px) { .payslip-grid { grid-template-columns: repeat(2, 1fr); } }
            .payslip-grid .label { color:#6B7280; }
            .payslip-grid .value { font-weight: 600; color:#111827; }
            .payslip-table { width:100%; border-collapse: collapse; margin-top: 8px; font-size: 12px; }
            .payslip-table th, .payslip-table td { border: 1px solid #E5E7EB; padding: 6px 8px; }
            .payslip-table thead th { background:#F3F4F6; color:#374151; text-align:left; }
            .payslip-table .total td { font-weight: 800; }
            .payslip-notes { margin-top: 10px; font-size: 12px; background:#F9FAFB; border:1px solid #E5E7EB; border-radius: 8px; padding: 8px 10px; }
            .payslip-notes .label { color:#6B7280; margin-bottom: 4px; }
            .payslip-footer { margin-top: 14px; color:#6B7280; font-size: 11px; text-align:right; }
        </style>
        <style id="modal-overlay-fix">
            /* Harden modal overlay so nothing bleeds through or captures events */
            .modal { z-index: 100000 !important; position: fixed !important; inset: 0 !important; width: 100vw !important; height: 100vh !important; }
            body.modal-open { overflow: hidden !important; overscroll-behavior: contain; }
            body.modal-open > :not(.modal) { pointer-events: none !important; }
            body.modal-open #toastContainer, body.modal-open #openSidebarBtn { display: none !important; }
            .backdrop { position: fixed; inset: 0; background: rgba(17,24,39,0.78); z-index: 99990; display: none; }
            body.modal-open .backdrop { display: block; }
        </style>
                <style id="payroll-table-styles">
                    /* Compact payroll table styles for better space utilization */
                    #payrollModal .payroll-table { 
                        font-size: 10px; 
                        table-layout: fixed;
                        width: 100%;
                    }

                    #payrollModal .payroll-table th { 
                        font-size: 9px; 
                        padding: 6px 4px; 
                        white-space: nowrap;
                        font-weight: 600;
                        text-transform: uppercase;
                        letter-spacing: 0.025em;
                    }

                    #payrollModal .payroll-table td { 
                        padding: 4px; 
                        font-size: 10px;
                        overflow: hidden;
                        text-overflow: ellipsis;
                    }

                    /* Column width optimization */
                    #payrollModal .payroll-table th:nth-child(1), 
                    #payrollModal .payroll-table td:nth-child(1) { width: 3%; } /* # */

                    #payrollModal .payroll-table th:nth-child(2), 
                    #payrollModal .payroll-table td:nth-child(2) { width: 12%; min-width: 100px; } /* Name */

                    #payrollModal .payroll-table th:nth-child(3), 
                    #payrollModal .payroll-table td:nth-child(3) { width: 8%; } /* Type */

                    #payrollModal .payroll-table th:nth-child(4), 
                    #payrollModal .payroll-table td:nth-child(4) { width: 10%; } /* Company */

                    #payrollModal .payroll-table th:nth-child(5), 
                    #payrollModal .payroll-table td:nth-child(5) { width: 10%; } /* QID */

                    #payrollModal .payroll-table th:nth-child(6), 
                    #payrollModal .payroll-table td:nth-child(6) { width: 10%; } /* Bank */

                    #payrollModal .payroll-table th:nth-child(7), 
                    #payrollModal .payroll-table td:nth-child(7) { width: 12%; } /* Account */

                    #payrollModal .payroll-table th:nth-child(8), 
                    #payrollModal .payroll-table td:nth-child(8) { width: 13%; } /* IBAN */

                    #payrollModal .payroll-table th:nth-child(9), 
                    #payrollModal .payroll-table td:nth-child(9) { width: 10%; text-align: right; } /* Monthly Salary */

                    #payrollModal .payroll-table th:nth-child(10), 
                    #payrollModal .payroll-table td:nth-child(10) { width: 10%; text-align: right; } /* Current Balance */

                    /* Make account numbers and IBANs more readable */
                    #payrollModal .mono-text { 
                        font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace; 
                        font-size: 9px;
                        letter-spacing: -0.025em;
                    }

                    /* Responsive adjustments for smaller screens */
                    @media (max-width: 1400px) {
                        #payrollModal .payroll-table { font-size: 9px; }
                        #payrollModal .payroll-table th { font-size: 8px; padding: 4px 3px; }
                        #payrollModal .payroll-table td { padding: 3px; font-size: 9px; }
                        #payrollModal .mono-text { font-size: 8px; }
                    }

                    /* Better scroll container */
                    #payrollModal .table-container { 
                        overflow-x: auto; 
                        max-width: 100%; 
                        scrollbar-width: thin; 
                        scrollbar-color: #cbd5e0 #f7fafc;
                        margin: 0 -8px;
                        padding: 0 8px;
                    }

                    /* Hover state for better row identification */
                    #payrollModal .payroll-table tbody tr:hover {
                        background-color: rgba(99, 102, 241, 0.04);
                    }

                    /* Section headers styling */
                    #payrollModal h4 {
                        font-size: 13px;
                        margin: 12px 0 8px 0;
                        font-weight: 700;
                    }
                </style>
                    <style id="payroll-print-styles">
                    /* Print-specific optimizations for payroll report */
                    @media print {
                        @page {
                            size: A4 landscape;
                            margin: 10mm;
                        }
    
                        #payrollTabReport {
                            font-size: 9px !important;
                        }
    
                        #payrollTabReport table {
                            font-size: 8px !important;
                            page-break-inside: avoid;
                        }
    
                        #payrollTabReport th,
                        #payrollTabReport td {
                            padding: 1px 2px !important;
                            font-size: 8px !important;
                        }
    
                        #payrollTabReport .mono-text {
                            font-family: 'Courier New', monospace !important;
                            font-size: 7px !important;
                            letter-spacing: -0.5px !important;
                        }
    
                        /* Hide non-essential elements */
                        #payrollTabReport button,
                        #payrollTabReport .btn {
                            display: none !important;
                        }
    
                        /* Ensure full content visibility */
                        #payrollTabReport td {
                            overflow: visible !important;
                            text-overflow: clip !important;
                            white-space: normal !important;
                            word-break: break-word !important;
                        }
                    }

                    /* Screen view optimizations */
                    #payrollTabReport .mono-text {
                        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
                        font-size: 8px;
                        letter-spacing: -0.3px;
                    }

                    #payrollTabReport .compact-badge {
                        padding: 0 4px;
                        font-size: 7px;
                        display: inline-block;
                        border-radius: 2px;
                    }
                    </style>
</head>
<body>
    <!-- Login Page with modern design -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-500 to-purple-600 p-6">
        <div class="card w-full max-w-md p-8">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-gradient-to-br from-indigo-500 to-violet-500 rounded-2xl mx-auto mb-6 flex items-center justify-center">
                    <i class="fas fa-users text-white text-3xl"></i>
                </div>
                <h1 class="text-2xl font-extrabold bg-gradient-to-r from-indigo-500 to-indigo-700 bg-clip-text text-transparent">Welcome Back</h1>
                <p class="text-gray-500">Sign in to manage your team</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label for="loginEmail" class="flex items-center gap-2 font-semibold text-sm text-gray-700 mb-1"><i class="fas fa-envelope text-indigo-500"></i> Email Address</label>
                    <input type="email" id="loginEmail" placeholder="you@company.com" class="w-full border-2 border-gray-200 rounded-md px-3 py-2 focus:outline-none focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500" />
                </div>
                <div>
                    <label for="loginPassword" class="flex items-center gap-2 font-semibold text-sm text-gray-700 mb-1"><i class="fas fa-lock text-indigo-500"></i> Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" class="w-full border-2 border-gray-200 rounded-md px-3 py-2 focus:outline-none focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500" />
                </div>
                <div class="grid grid-cols-2 gap-3 pt-2">
                    <button id="loginSignInBtn" class="btn btn-primary justify-center"><i class="fas fa-sign-in-alt"></i> Sign In</button>
                    <button id="loginSignUpBtn" class="btn btn-secondary justify-center"><i class="fas fa-user-plus"></i> Sign Up</button>
                </div>
                <div class="text-center">
                    <button id="loginResetBtn" class="btn btn-ghost"><i class="fas fa-key"></i> Forgot Password?</button>
                </div>
            </div>
        </div>
    </div>

        <!-- Main App with modern UI -->
        <div id="appRoot" style="display:none;">
            <div class="flex min-h-screen">
                <!-- Sidebar -->
                <aside id="sidebar" class="w-64 bg-white border-r border-gray-200 p-6 hidden md:flex md:flex-col">
                    <div class="flex items-center justify-between mb-6">
                        <div class="text-xl font-extrabold bg-gradient-to-r from-indigo-500 to-indigo-700 bg-clip-text text-transparent">CRM</div>
                        <button id="collapseSidebarBtn" class="btn btn-ghost" title="Hide Sidebar" aria-label="Hide Sidebar"><i class="fas fa-chevron-left"></i></button>
                    </div>
                    <nav class="space-y-1">
                        <button class="w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800 font-semibold" data-nav="dashboard">
                            <i class="fas fa-chart-line text-indigo-500"></i>
                            <span>Dashboard</span>
                        </button>
                        <button class="w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800 font-semibold" data-nav="payroll">
                            <i class="fas fa-file-invoice-dollar text-indigo-500"></i>
                            <span>Payroll</span>
                        </button>
                        <button class="w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800 font-semibold" data-nav="employees">
                            <i class="fas fa-users text-indigo-500"></i>
                            <span>Employees</span>
                        </button>
                        <button class="w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800 font-semibold" data-nav="temporary">
                            <i class="fas fa-user-clock text-indigo-500"></i>
                            <span>Temporary Employees</span>
                        </button>
                        <button class="w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800 font-semibold" data-nav="clients">
                            <i class="fas fa-handshake text-indigo-500"></i>
                            <span>Clients</span>
                        </button>
                        <button class="w-full text-left flex items-center gap-3 px-10 py-2 rounded-lg hover:bg-gray-100 text-gray-700" data-nav="clients-billing" title="Client Transactions">
                            <i class="fas fa-file-invoice-dollar text-indigo-400"></i>
                            <span>Client Transactions</span>
                        </button>
                        <button class="w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800 font-semibold" data-nav="accounts">
                            <i class="fas fa-wallet text-indigo-500"></i>
                            <span>Accounts</span>
                        </button>
                    </nav>
                    <div class="mt-auto pt-6">
                        <button id="signOutBtnSidebar" class="btn btn-secondary w-full"><i class="fas fa-sign-out-alt"></i> Sign Out</button>
                    </div>
                </aside>
                <!-- Main content -->
                <main class="flex-1 max-w-7xl mx-auto p-8 space-y-8">
                <!-- Floating open sidebar button (shown when sidebar is hidden) -->
                <button id="openSidebarBtn" class="btn btn-secondary fixed left-2 top-2 z-40 hidden md:inline-flex" title="Show Sidebar" aria-label="Show Sidebar"><i class="fas fa-bars"></i></button>
                <!-- Header -->
                <div class="card p-8 relative overflow-hidden">
            <div class="flex items-center justify-between">
                <div></div>
                <div class="flex items-center gap-3">
                    <!-- Notifications Bell (no functionality yet) -->
                                        <span class="notifications-wrapper relative inline-flex">
                                            <button id="notificationsBtn" class="btn btn-ghost relative" title="Notifications" aria-label="Notifications" aria-haspopup="true" aria-expanded="false">
                                                    <i class="fas fa-bell"></i>
                                                    <span id="notificationsBadge" class="absolute -top-1 -right-1 w-2 h-2 bg-rose-500 rounded-full ring-2 ring-white hidden"></span>
                                                    <span class="sr-only">Notifications</span>
                                            </button>
                                            <div id="notificationsPanel" class="hidden" role="region" aria-label="Notifications" tabindex="-1">
                                                <div class="notif-header">
                                                    <h4 class="notif-title">Alerts</h4>
                                                    <button type="button" id="notificationsClearBtn" class="notif-clear" title="Dismiss" aria-label="Dismiss notifications"><i class="fas fa-times"></i></button>
                                                </div>
                                                <div id="notificationsList" class="notif-list empty">
                                                    <div class="notif-empty text-gray-500 text-sm">No alerts</div>
                                                </div>
                                            </div>
                                        </span>
                    <div class="user-badge flex items-center gap-2 bg-gray-50 border-2 border-gray-100 rounded-lg px-3 py-2">
                        <div class="user-avatar w-8 h-8 rounded-md bg-gradient-to-br from-indigo-500 to-indigo-400 text-white flex items-center justify-center text-sm font-semibold" id="userAvatar">A</div>
                        <span class="user-email text-sm font-medium text-gray-700" id="userName">admin@company.com</span>
                    </div>
                </div>
            </div>
            <div class="absolute inset-x-0 top-0 h-[3px] bg-gradient-to-r from-indigo-500 to-indigo-400"></div>
    </div>

        <!-- Search and Filter Controls -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="md:col-span-2 relative">
                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                <input id="searchInput" type="search" placeholder="Search by Qatar ID, name, email, position..." class="w-full pl-10 pr-4 py-2 border-2 border-gray-200 rounded-md focus:outline-none focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500" />
            </div>
            <div class="flex items-center gap-3 justify-end">
                <button id="openEmployeeModalBtn" class="btn btn-primary btn-lg">
                    <i class="fas fa-user-plus"></i>
                    <span>Add Employee</span>
                </button>
                <button id="openTempEmployeeModalBtn" class="btn btn-primary btn-lg" style="display:none;">
                    <i class="fas fa-user-clock"></i>
                    <span>Add Temporary</span>
                </button>
            </div>
        </div>

        <!-- Dashboard Section -->
        <section id="dashboardSection" data-section="dashboard" class="space-y-8">
            <!-- Modern Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-1 gap-6">
                <div class="card p-6 relative overflow-hidden">
                    <div class="w-12 h-12 bg-gradient-to-br from-indigo-400 to-indigo-500 rounded-md flex items-center justify-center text-white text-xl mb-4"><i class="fas fa-users"></i></div>
                    <div id="totalEmployees" class="text-3xl font-extrabold text-gray-900">0</div>
                    <div class="text-sm font-semibold uppercase tracking-wider text-gray-500">Total Employees</div>
                    <span class="absolute top-4 right-4 text-xs font-semibold text-white bg-emerald-500 px-2 py-1 rounded">+12%</span>
                </div>
            </div>
        </section>

    <!-- Hidden print container for Ledger -->
    <div id="ledgerPrintArea"></div>

        <!-- Clients Section -->
        <section id="clientsSection" data-section="clients" class="space-y-8" style="display:none;">
            <div class="card overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-100 bg-gray-50 flex items-center justify-between">
                    <h3 class="text-lg font-bold text-gray-900">Clients</h3>
                    <div class="flex items-center gap-3">
                        <!-- Simple select filter populated at runtime -->
                        <select id="clientsFilterSelect" class="input min-w-[240px]">
                            <option value="">All clients…</option>
                        </select>
                        <button id="openAssignmentModalBtn" class="btn btn-secondary"><i class="fas fa-people-arrows"></i> Assign Employee</button>
                        <button id="openClientModalBtn" class="btn btn-primary"><i class="fas fa-plus"></i> Add Client</button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full table-fixed text-sm">
                        <colgroup>
                            <col class="w-[18%]" />  <!-- Company -->
                            <col class="w-[18%]" />  <!-- Company Email -->
                            <col class="w-[13%]" />  <!-- Company Phone -->
                            <col class="w-[15%]" />  <!-- Contact Person -->
                            <col class="w-[12%]" />  <!-- Monthly -->
                            <col class="w-[8%]" />   <!-- No. of Employees Assigned -->
                            <col class="w-[16%]" />  <!-- Address -->
                            <col class="w-[8%]" />   <!-- Actions -->
                        </colgroup>
                        <thead class="bg-gray-50 text-gray-600 text-xs uppercase tracking-wide">
                            <tr>
                                <th class="text-left font-semibold px-4 py-3">Company</th>
                                <th class="text-left font-semibold px-4 py-3">Company Email</th>
                                <th class="text-left font-semibold px-4 py-3">Company Phone</th>
                                <th class="text-left font-semibold px-4 py-3">Contact Person</th>
                                <th class="text-right font-semibold px-4 py-3">Monthly</th>
                                <th class="text-center font-semibold px-4 py-3">No. of Employees Assigned</th>
                                <th class="text-left font-semibold px-4 py-3">Address</th>
                                <th class="text-center font-semibold px-4 py-3">Actions</th>
                                
                            </tr>
                        </thead>
                        <tbody id="clientsTableBody" class="divide-y divide-gray-100"></tbody>
                    </table>
                </div>
                <div class="empty-state hidden" id="clientsEmptyState">
                    <div class="empty-state-icon"><i class="fas fa-inbox"></i></div>
                    <h3 class="text-lg font-semibold text-gray-700">No Clients Found</h3>
                    <p class="text-gray-500">Add a client to get started</p>
                </div>
            </div>
        </section>

    <!-- Clients Transactions Section -->
        <section id="clientsBillingSection" data-section="clients-billing" class="space-y-8" style="display:none;">
            <div class="card overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-100 bg-gray-50 flex items-center justify-between">
                    <h3 class="text-lg font-bold text-gray-900">Client Transactions (Monthly)
                        <span id="clientBillingSelectedName" class="ml-2 text-indigo-600 font-semibold"></span>
                    </h3>
                    <div class="flex items-center gap-3">
                        <label class="text-sm text-gray-600">Month</label>
                        <input id="clientBillingMonth" type="month" class="input" />
                        <label class="text-sm text-gray-600">Client</label>
                        <select id="clientBillingClient" class="input min-w-[240px]"></select>
                        <button id="openClientPaymentBtn" class="btn btn-primary" disabled title="Record a payment for the selected month and client"><i class="fas fa-hand-holding-dollar"></i> Record Payment</button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full table-fixed text-sm">
                        <colgroup>
                            <col class="w-[14%]" />  <!-- Date -->
                            <col class="w-[12%]" />  <!-- Assigned Employees -->
                            <col class="w-[14%]" />  <!-- Monthly Amount -->
                            <col class="w-[14%]" />  <!-- Debited -->
                            <col class="w-[14%]" />  <!-- Credited -->
                            <col class="w-[14%]" />  <!-- Outstanding -->
                            <col class="w-[18%]" />  <!-- Notes -->
                        </colgroup>
                        <thead class="bg-gray-50 text-gray-600 text-xs uppercase tracking-wide">
                            <tr>
                                <th class="text-left font-semibold px-4 py-3">Date</th>
                                <th class="text-left font-semibold px-4 py-3">Assigned</th>
                                <th class="text-right font-semibold px-4 py-3">Monthly</th>
                                <th class="text-right font-semibold px-4 py-3">Debited</th>
                                <th class="text-right font-semibold px-4 py-3">Credited</th>
                                <th class="text-right font-semibold px-4 py-3">Outstanding</th>
                                <th class="text-left font-semibold px-4 py-3">Notes</th>
                            </tr>
                        </thead>
                        <tbody id="clientBillingTableBody" class="divide-y divide-gray-100"></tbody>
                    </table>
                </div>
                <div class="empty-state hidden" id="clientBillingEmpty">
                    <div class="empty-state-icon"><i class="fas fa-inbox"></i></div>
                    <h3 class="text-lg font-semibold text-gray-700">No Clients</h3>
                    <p class="text-gray-500">Add clients or assignments to see transactions here</p>
                </div>
            </div>
        </section>

        <!-- Client Payment Modal -->
        <div class="modal" id="clientPaymentModal" role="dialog" aria-modal="true" aria-labelledby="clientPaymentModalTitle">
            <div class="modal-content max-w-md w-full">
                <div class="modal-header flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-hand-holding-dollar text-indigo-600"></i>
                        <h3 id="clientPaymentModalTitle" class="modal-title">Record Client Payment</h3>
                    </div>
                    <button class="btn btn-ghost" aria-label="Close" onclick="closeClientPaymentModal()"><i class="fas fa-times"></i></button>
                </div>
                <div class="modal-body">
                    <form id="clientPaymentForm" class="space-y-4">
                        <div class="bg-gray-50 border border-gray-200 rounded p-3 text-sm text-gray-700">
                            <div>Client: <span id="clientPaymentClientName" class="font-semibold">—</span></div>
                            <div>Month: <span id="clientPaymentMonth" class="font-semibold">—</span></div>
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-calendar-day label-icon"></i> Date</label>
                            <input id="cpDate" type="date" class="input" readonly />
                            <p class="text-xs text-gray-500 mt-1">Uses the selected month’s date when recording a monthly payment.</p>
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-wallet label-icon"></i> Account</label>
                            <select id="cpAccount" class="input" required></select>
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-dollar-sign label-icon"></i> Amount</label>
                            <input id="cpAmount" type="number" step="any" class="input" required />
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-sticky-note label-icon"></i> Notes (optional)</label>
                            <textarea id="cpNotes" class="input" rows="2" placeholder="Details..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer flex items-center justify-end gap-2">
                    <button type="button" class="btn btn-secondary" onclick="closeClientPaymentModal()"><i class="fas fa-times"></i> Cancel</button>
                    <button type="submit" form="clientPaymentForm" class="btn btn-primary"><i class="fas fa-save"></i> Save Payment</button>
                </div>
            </div>
        </div>

        <!-- Accounts Section (Redesigned) -->
        <section id="accountsSection" data-section="accounts" class="space-y-8" style="display:none;">
            <div class="card overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-100 bg-gray-50 flex items-center justify-between">
                    <h3 class="text-lg font-bold text-gray-900">Accounts</h3>
                    <div class="flex items-center gap-2">
                        <button id="openIncomeTxnBtn" class="btn btn-primary" onclick="(window.openCashTxnModal && window.openCashTxnModal({ type: 'in' })) || (window.__openCashTxnFallback && window.__openCashTxnFallback('in'))"><i class="fas fa-arrow-down"></i> Income</button>
                        <button id="openExpenseTxnBtn" class="btn btn-danger" onclick="(window.openCashTxnModal && window.openCashTxnModal({ type: 'out' })) || (window.__openCashTxnFallback && window.__openCashTxnFallback('out'))"><i class="fas fa-arrow-up"></i> Expense</button>
                        <button id="openTransferBtn" class="btn btn-secondary" onclick="window.openTransferModal && window.openTransferModal()"><i class="fas fa-right-left"></i> Transfer</button>
                        <button id="setCurrentFundBtn" class="btn btn-secondary"><i class="fas fa-pen"></i> Set Current Fund</button>
                    </div>
                </div>

                <!-- Current Fund -->
                <div class="px-6 py-4 bg-white">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="rounded-lg border border-gray-100 p-4 flex items-center justify-between md:col-span-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-gradient-to-br from-indigo-400 to-indigo-500 rounded-md flex items-center justify-center text-white">
                                    <i class="fas fa-sack-dollar"></i>
                                </div>
                                <div>
                                    <div class="text-xs uppercase text-gray-500 font-semibold">Current Fund Available</div>
                                    <div id="accountsFundValue" class="text-2xl font-extrabold text-gray-900">$0</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <div id="accountsFundAsOf" class="text-xs text-gray-500"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sub-Tabs: Overview, Transactions, Ledger, Settings -->
                <div class="border-b">
                    <div class="flex items-center gap-2 px-4">
                        <button id="accountsSubTabOverviewBtn" class="px-3 py-2 rounded-t-md font-semibold text-indigo-600 border-b-2 border-indigo-600" onclick="window.setAccountsSubTab && window.setAccountsSubTab('overview')">Overview</button>
                        <button id="accountsSubTabLedgerBtn" class="px-3 py-2 rounded-t-md text-gray-600 hover:text-gray-800" onclick="window.setAccountsSubTab && window.setAccountsSubTab('ledger')">Ledger</button>
                        <button id="accountsSubTabSettingsBtn" class="px-3 py-2 rounded-t-md text-gray-600 hover:text-gray-800" onclick="window.setAccountsSubTab && window.setAccountsSubTab('settings')">Settings</button>
                    </div>
                </div>

                <!-- Tab: Overview -->
                <div id="accountsTabOverview" class="px-4 py-4 space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="card p-4">
                            <div class="text-xs uppercase text-gray-500">Today In</div>
                            <div id="overviewTodayIn" class="text-xl font-bold">$0</div>
                        </div>
                        <div class="card p-4">
                            <div class="text-xs uppercase text-gray-500">Today Out</div>
                            <div id="overviewTodayOut" class="text-xl font-bold">$0</div>
                        </div>
                        <div class="card p-4">
                            <div class="text-xs uppercase text-gray-500">This Month In</div>
                            <div id="overviewMonthIn" class="text-xl font-bold">$0</div>
                        </div>
                        <div class="card p-4">
                            <div class="text-xs uppercase text-gray-500">This Month Out</div>
                            <div id="overviewMonthOut" class="text-xl font-bold">$0</div>
                        </div>
                    </div>
                    <div class="card p-4">
                        <div class="flex items-center justify-between mb-2">
                            <div class="text-sm font-semibold text-gray-700">Recent Transactions</div>
                            <div class="flex items-center gap-2">
                                <button class="btn btn-secondary btn-sm" onclick="window.openTransferModal && window.openTransferModal()"><i class="fas fa-right-left"></i> Transfer</button>
                            </div>
                        </div>
                        <div id="accountsRecentEmpty" class="text-sm text-gray-500">No recent transactions</div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full table-fixed text-sm" id="accountsRecentTable" style="display:none;">
                                <colgroup>
                                    <col class="w-[14%]" />
                                    <col class="w-[24%]" />
                                    <col class="w-[12%]" />
                                    <col class="w-[18%]" />
                                    <col class="w-[14%]" />
                                    <col class="w-[18%]" />
                                </colgroup>
                                <thead class="bg-gray-50 text-gray-600 text-xs uppercase tracking-wide">
                                    <tr>
                                        <th class="text-left font-semibold px-4 py-3">Date</th>
                                        <th class="text-left font-semibold px-4 py-3">Account</th>
                                        <th class="text-left font-semibold px-4 py-3">Type</th>
                                        <th class="text-left font-semibold px-4 py-3">Category</th>
                                        <th class="text-right font-semibold px-4 py-3">Amount</th>
                                        <th class="text-left font-semibold px-4 py-3">Notes</th>
                                    </tr>
                                </thead>
                                <tbody id="accountsRecentTbody" class="divide-y divide-gray-100"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                

                <!-- Tab: Ledger (reuse existing markup) -->
                <div id="accountsTabLedger" class="overflow-x-auto" style="display:none;">
                    <div class="px-4 py-3 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
                        <div class="flex items-center gap-3">
                            <label class="text-sm text-gray-600">Month</label>
                            <input id="ledgerMonth" type="month" class="input" />
                                <label class="text-sm text-gray-600">Day</label>
                                <input id="ledgerDay" type="date" class="input" />
                            <label class="text-sm text-gray-600">Account</label>
                            <select id="ledgerAccountFilter" class="input min-w-[240px]"></select>
                        </div>
                        <div class="flex items-center gap-3 flex-wrap justify-end">
                            <button id="ledgerExportBtn" class="btn btn-secondary" title="Export current ledger to CSV"><i class="fas fa-file-csv"></i> <span class="hidden sm:inline">Export</span></button>
                            <button id="ledgerPrintBtn" class="btn btn-primary" title="Print current ledger"><i class="fas fa-print"></i> <span class="hidden sm:inline">Print</span></button>
                            <div id="ledgerSummary" class="text-sm text-gray-600"></div>
                        </div>
                    </div>
                    <table class="min-w-full table-fixed text-sm">
                        <colgroup>
                            <col class="w-[14%]" />
                            <col class="w-[36%]" />
                            <col class="w-[16%]" />
                            <col class="w-[16%]" />
                            <col class="w-[18%]" />
                        </colgroup>
                        <thead class="bg-gray-50 text-gray-600 text-xs uppercase tracking-wide">
                            <tr>
                                <th class="text-left font-semibold px-4 py-3">Date</th>
                                <th class="text-left font-semibold px-4 py-3">Description</th>
                                <th class="text-right font-semibold px-4 py-3">Debit</th>
                                <th class="text-right font-semibold px-4 py-3">Credit</th>
                                <th class="text-right font-semibold px-4 py-3">Balance</th>
                            </tr>
                        </thead>
                        <tbody id="ledgerTableBody" class="divide-y divide-gray-100"></tbody>
                    </table>
                    <div class="empty-state hidden" id="ledgerEmptyState">
                        <div class="empty-state-icon"><i class="fas fa-inbox"></i></div>
                        <h3 class="text-lg font-semibold text-gray-700">No Entries</h3>
                        <p class="text-gray-500">Choose an account to view its ledger</p>
                    </div>
                </div>

                <!-- Tab: Settings (simple list for now) -->
                <div id="accountsTabSettings" class="overflow-x-auto" style="display:none;">
                    <div class="px-4 py-3 text-sm text-gray-600">Accounts are managed automatically. You can review existing accounts below.</div>
                    <table class="min-w-full table-fixed text-sm">
                        <colgroup>
                            <col class="w-[40%]" />
                            <col class="w-[30%]" />
                            <col class="w-[30%]" />
                        </colgroup>
                        <thead class="bg-gray-50 text-gray-600 text-xs uppercase tracking-wide">
                            <tr>
                                <th class="text-left font-semibold px-4 py-3">Account Name</th>
                                <th class="text-left font-semibold px-4 py-3">Type</th>
                                <th class="text-right font-semibold px-4 py-3">Amount</th>
                            </tr>
                        </thead>
                        <tbody id="accountsTableBody" class="divide-y divide-gray-100"></tbody>
                    </table>
                    <div class="empty-state hidden" id="accountsEmptyState">
                        <div class="empty-state-icon"><i class="fas fa-inbox"></i></div>
                        <h3 class="text-lg font-semibold text-gray-700">No Accounts Found</h3>
                        <p class="text-gray-500">Accounts will appear here automatically when used.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Transfer Modal -->
        <div class="modal" id="transferModal" role="dialog" aria-modal="true" aria-labelledby="transferModalTitle">
            <div class="modal-content max-w-md w-full">
                <div class="modal-header flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-right-left text-indigo-600"></i>
                        <h3 id="transferModalTitle" class="modal-title">Transfer Funds</h3>
                    </div>
                    <button class="btn btn-ghost" aria-label="Close" onclick="closeTransferModal()"><i class="fas fa-times"></i></button>
                </div>
                <div class="modal-body">
                    <form id="transferForm" class="space-y-4">
                        <div>
                            <label class="label"><i class="fas fa-calendar-day label-icon"></i> Date</label>
                            <input id="tfDate" type="date" class="input" required />
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="label"><i class="fas fa-wallet label-icon"></i> From Account</label>
                                <select id="tfFromAccount" class="input" required></select>
                            </div>
                            <div>
                                <label class="label"><i class="fas fa-wallet label-icon"></i> To Account</label>
                                <select id="tfToAccount" class="input" required></select>
                            </div>
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-dollar-sign label-icon"></i> Amount</label>
                            <input id="tfAmount" type="number" step="any" class="input" required />
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-sticky-note label-icon"></i> Notes (optional)</label>
                            <textarea id="tfNotes" class="input" rows="2" placeholder="Details..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer flex items-center justify-end gap-2">
                    <button type="button" class="btn btn-secondary" onclick="closeTransferModal()"><i class="fas fa-times"></i> Cancel</button>
                    <button type="submit" form="transferForm" class="btn btn-primary"><i class="fas fa-save"></i> Save Transfer</button>
                </div>
            </div>
        </div>

        <!-- Edit Current Fund Modal -->
        <div class="modal" id="editFundModal" role="dialog" aria-modal="true" aria-labelledby="editFundTitle">
            <div class="modal-content max-w-md w-full">
                <div class="modal-header flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-sack-dollar text-indigo-600"></i>
                        <h3 id="editFundTitle" class="modal-title">Set Current Fund</h3>
                    </div>
                    <button class="btn btn-ghost" aria-label="Close" onclick="closeEditFundModal()"><i class="fas fa-times"></i></button>
                </div>
                <div class="modal-body">
                    <form id="editFundForm" class="space-y-4">
                        <div class="bg-gray-50 border border-gray-200 rounded p-3 text-sm text-gray-700">
                            <div>Computed Fund: <span id="computedFundLabel" class="font-semibold">$0</span></div>
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-dollar-sign label-icon"></i> Set Current Fund To</label>
                            <input id="desiredFund" type="number" step="any" class="input" required />
                            <p class="text-xs text-gray-500 mt-1">This will only update the Fund opening so that opening + net cashflows equals this amount. It will not add or modify any transactions.</p>
                        </div>
                    </form>
                </div>
                <div class="modal-footer flex items-center justify-end gap-2">
                    <button type="button" class="btn btn-secondary" onclick="closeEditFundModal()"><i class="fas fa-times"></i> Cancel</button>
                    <button id="editFundSaveBtn" type="submit" form="editFundForm" class="btn btn-primary"><i class="fas fa-save"></i> <span class="btn-text">Save</span><span class="btn-busy hidden ml-2"><i class="fas fa-circle-notch fa-spin"></i></span></button>
                </div>
            </div>
        </div>

        
        <!-- Add Cash Transaction Modal -->
        <div class="modal" id="cashTxnModal" role="dialog" aria-modal="true" aria-labelledby="cashTxnModalTitle">
            <div class="modal-content max-w-xl w-full">
                <div class="modal-header flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-receipt text-indigo-600"></i>
                        <h3 id="cashTxnModalTitle" class="modal-title">Add Cash Transaction</h3>
                    </div>
                    <button class="btn btn-ghost" aria-label="Close" onclick="closeCashTxnModal()"><i class="fas fa-times"></i></button>
                </div>
                <div class="modal-body">
                    <form id="cashTxnForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="label"><i class="fas fa-calendar-day label-icon"></i> Date</label>
                                <input id="cfDate" type="date" class="input" required />
                            </div>
                            <div>
                                <label class="label"><i class="fas fa-arrow-right-arrow-left label-icon"></i> Type (locked when using Income/Expense buttons)</label>
                                <select id="cfType" class="input" required>
                                    <option value="in">In</option>
                                    <option value="out">Out</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-wallet label-icon"></i> Account</label>
                            <select id="cfAccount" class="input" required></select>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="label"><i class="fas fa-dollar-sign label-icon"></i> Amount</label>
                                <input id="cfAmount" type="number" step="any" class="input" required />
                            </div>
                            <div>
                                <label class="label"><i class="fas fa-tags label-icon"></i> Category (optional)</label>
                                <input id="cfCategory" type="text" class="input" placeholder="e.g., Materials, Rent, Sales" />
                            </div>
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-sticky-note label-icon"></i> Notes (optional)</label>
                            <textarea id="cfNotes" class="input" rows="3" placeholder="Details..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer flex items-center justify-end gap-2">
                    <button type="button" class="btn btn-secondary" onclick="closeCashTxnModal()"><i class="fas fa-times"></i> Cancel</button>
                    <button type="submit" form="cashTxnForm" class="btn btn-primary"><i class="fas fa-save"></i> Save Transaction</button>
                </div>
            </div>
        </div>

        <!-- Assignments Section (simple list) -->
        <section id="assignmentsSection" data-section="assignments" class="space-y-8" style="display:none;">
            <div class="card overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-100 bg-gray-50 flex items-center justify-between">
                    <h3 class="text-lg font-bold text-gray-900">Assignments</h3>
                    <button id="openAssignmentModalBtn2" class="btn btn-primary"><i class="fas fa-people-arrows"></i> New Assignment</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full table-fixed text-sm">
                        <colgroup>
                            <col class="w-[22%]" />  <!-- Employee -->
                            <col class="w-[24%]" />  <!-- Client -->
                            <col class="w-[14%]" />  <!-- Start -->
                            <col class="w-[14%]" />  <!-- End -->
                            <col class="w-[12%]" />  <!-- Rate -->
                            <col class="w-[14%]" />  <!-- Actions -->
                        </colgroup>
                        <thead class="bg-gray-50 text-gray-600 text-xs uppercase tracking-wide">
                            <tr>
                                <th class="text-left font-semibold px-4 py-3">Employee</th>
                                <th class="text-left font-semibold px-4 py-3">Client</th>
                                <th class="text-left font-semibold px-4 py-3">Start</th>
                                <th class="text-left font-semibold px-4 py-3">End</th>
                                <th class="text-left font-semibold px-4 py-3">Rate</th>
                                <th class="text-center font-semibold px-4 py-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="assignmentsTableBody" class="divide-y divide-gray-100"></tbody>
                    </table>
                </div>
                <div class="empty-state hidden" id="assignmentsEmptyState">
                    <div class="empty-state-icon"><i class="fas fa-inbox"></i></div>
                    <h3 class="text-lg font-semibold text-gray-700">No Assignments Found</h3>
                    <p class="text-gray-500">Create an assignment to get started</p>
                </div>
            </div>
        </section>

        <!-- Payroll Section -->
                <section id="payrollSection" data-section="payroll" class="space-y-8" style="display:none;">
            <div class="grid grid-cols-1 md:grid-cols-1 gap-6">
                <div class="card p-6 relative overflow-hidden">
                    <div class="w-12 h-12 bg-gradient-to-br from-indigo-400 to-indigo-500 rounded-md flex items-center justify-center text-white text-xl mb-4"><i class="fas fa-file-invoice-dollar"></i></div>
                    <div id="totalPayroll" class="text-3xl font-extrabold text-gray-900">$0</div>
                    <div class="text-sm font-semibold uppercase tracking-wider text-gray-500">Total Monthly Payroll</div>
                </div>
            </div>

                        <!-- Payroll Tabs -->
                        <div class="border-b mb-2">
                            <div class="flex items-center gap-2">
                                <button id="payrollTabTableBtn" class="px-3 py-2 rounded-t-md font-semibold text-indigo-600 border-b-2 border-indigo-600">Table</button>
                                <button id="payrollTabReportBtn" class="px-3 py-2 rounded-t-md text-gray-600 hover:text-gray-800">Month Report</button>
                            </div>
                        </div>

                        <!-- Payroll Table (sub-tab: Table) -->
                        <div id="payrollTabTable" class="space-y-8">
                            <div class="card overflow-hidden">
                                <div class="px-6 py-4 border-b border-gray-100 bg-gray-50"><h3 class="text-lg font-bold text-gray-900">Payroll</h3></div>
                                <div class="overflow-x-auto">
                                                            <style>
                      /* Scoped compact styles for Payroll table only */
                      #payrollTabTable table { font-size: 13px; }
                      #payrollTabTable thead th { padding-top: 10px; padding-bottom: 10px; padding-left: 12px; padding-right: 12px; }
                      #payrollTabTable tbody td { padding-top: 8px; padding-bottom: 8px; padding-left: 12px; padding-right: 12px; }
                      #payrollTabTable .btn-compact { padding: 6px 12px; font-size: 13px; line-height: 1.2; }
                      #payrollTabTable .btn-compact i { font-size: 14px; }
                                                                /* Ensure Start Date column has visible width (moderate) */
                                                                #payrollTabTable thead th:nth-child(6),
                                                                #payrollTabTable tbody td:nth-child(6) { width: 130px; min-width: 130px; }
                                                                /* Tighten spacing specifically between Start Date (6) and Qatar ID (7) */
                                                                #payrollTabTable thead th:nth-child(6) { padding-right: 10px !important; }
                                                                #payrollTabTable thead th:nth-child(7) { padding-left: 10px !important; }
                                                                #payrollTabTable tbody td:nth-child(6) { padding-right: 10px !important; }
                                                                #payrollTabTable tbody td:nth-child(7) { padding-left: 10px !important; }
                    </style>
                                        <table class="min-w-full table-fixed text-[13px]">
                        <colgroup>
                                                        <col class="w-[16%]" />  <!-- Name -->
                                                        <col class="w-[7%]" />   <!-- Type -->
                                                        <col class="w-[12%]" />  <!-- Company -->
                                                        <col class="w-[11%]" />  <!-- Monthly Salary -->
                                                        <col class="w-[11%]" />  <!-- Current Salary Balance -->
                                                <col class="w-[12%]" />  <!-- Start Date (slightly narrower) -->
                                                <col class="w-[8%]" />   <!-- Qatar ID (slightly wider for digits) -->
                                                <col class="w-[24%]" />  <!-- Actions (balanced) -->
                        </colgroup>
                        <thead class="bg-gray-50 text-gray-600 text-xs uppercase tracking-wide">
                            <tr>
                                <th class="text-left font-semibold px-2 py-1 cursor-pointer" onclick="sortPayroll('name')">Name <i class="fas fa-sort ml-1"></i></th>
                                <th class="text-left font-semibold px-2 py-1 cursor-pointer" onclick="sortPayroll('type')">Type <i class="fas fa-sort ml-1"></i></th>
                                <th class="text-left font-semibold px-2 py-1 cursor-pointer whitespace-nowrap" onclick="sortPayroll('department')">Company <i class="fas fa-sort ml-1"></i></th>
                                <th class="text-right font-semibold px-2 py-1 cursor-pointer whitespace-nowrap" onclick="sortPayroll('salary')">Monthly Salary <i class="fas fa-sort ml-1"></i></th>
                                                    <th class="text-right font-semibold px-2 py-1 whitespace-nowrap">Current Salary Balance</th>
                                                    <th class="text-left font-semibold px-2 py-1 cursor-pointer whitespace-nowrap w-[130px] min-w-[130px]" onclick="sortPayroll('joinDate')">Start Date <i class="fas fa-sort ml-1"></i></th>
                                <th class="text-left font-semibold px-2 py-1 cursor-pointer" onclick="sortPayroll('qid')">Qatar ID <i class="fas fa-sort ml-1"></i></th>
                                <th class="text-center font-semibold px-2 py-1">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="payrollTableBody" class="divide-y divide-gray-100"></tbody>
                    </table>
                </div>
                <div class="empty-state hidden" id="payrollEmptyState">
                    <div class="empty-state-icon"><i class="fas fa-inbox"></i></div>
                    <h3 class="text-lg font-semibold text-gray-700">No Records Found</h3>
                    <p class="text-gray-500">Add employees to see payroll here</p>
                </div>
            </div>
                        </div>

                        <!-- Payroll Month Report (sub-tab: Report) -->
                        <div id="payrollTabReport" class="space-y-4" style="display:none;">
                            <div class="card p-6">
                                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                                    <div class="flex items-center gap-3">
                                        <label for="payrollMonth" class="text-sm font-semibold text-gray-700 whitespace-nowrap"><i class="fas fa-calendar-alt text-indigo-500"></i> Payroll Month</label>
                                        <input id="payrollMonth" type="month" class="border-2 border-gray-200 rounded-md px-3 py-2 focus:outline-none focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500" />
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <button id="exportPayrollCsvBtn" class="btn btn-secondary"><i class="fas fa-file-csv"></i> Export CSV</button>
                                        <button id="printPayrollBtn" class="btn btn-primary"><i class="fas fa-print"></i> Print Payroll</button>
                                    </div>
                                </div>
                            </div>
                            <div class="card p-6">
                                <div id="payrollFrame" class="bg-white border border-gray-200 rounded-lg p-6">
                                    <!-- Rendered by script.js (renderPayrollFrame) -->
                                </div>
                            </div>
                        </div>
        </section>

    <!-- Employees Section -->
    <section id="employeesSection" data-section="employees" class="space-y-8">
    <div class="card overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-100 bg-gray-50"><h3 class="text-lg font-bold text-gray-900">Employee Directory</h3></div>
            <div class="overflow-x-auto">
                <table class="min-w-full table-fixed text-sm data-table">
                                        <style>
                                            /* Visual indicator for terminated employees */
                                            tr.terminated-row { background-color: #fff1f2; }
                                            tr.terminated-row:hover { background-color: #ffe4e6; }
                                            /* Ensure cells reflect the row background and override Tailwind hover/bg */
                                            tr.terminated-row > th,
                                            tr.terminated-row > td { background-color: #fff1f2 !important; }
                                            tr.terminated-row:hover > th,
                                            tr.terminated-row:hover > td { background-color: #ffe4e6 !important; }
                                            /* Force all descendants to inherit background to avoid white patches (but preserve status dots) */
                                            tr.terminated-row *:not(.expiry-dot):not(.status-dot) { background-color: #fff1f2 !important; }
                                            tr.terminated-row:hover *:not(.expiry-dot):not(.status-dot) { background-color: #ffe4e6 !important; }
                                        </style>
                    <colgroup>
                        <col class="w-[13%]" />  <!-- Name -->
                        <col class="w-[10%]" />  <!-- Email -->
                        <col class="w-[9%]" />   <!-- Phone -->
                        <col class="w-[9%]" />   <!-- Qatar ID -->
                        <col class="w-[6%]" />   <!-- Status -->
                        <col class="w-[18%]" />  <!-- Position -->
                        <col class="w-[11%]" />  <!-- Company -->
                        <col class="w-[11%]" />  <!-- Monthly Salary -->
                        <col class="w-[9%]" />   <!-- Join Date -->
                        <col class="w-[4%]" />   <!-- Actions -->
                    </colgroup>
                    <thead class="bg-gray-50 text-gray-600 text-xs uppercase tracking-wide">
                        <tr>
                            <th class="col-name text-left font-semibold px-4 py-3 cursor-pointer" onclick="sortTable('name')">Name <i class="fas fa-sort ml-1"></i></th>
                            <th class="col-email text-left font-semibold px-4 py-3 cursor-pointer" onclick="sortTable('email')">Email <i class="fas fa-sort ml-1"></i></th>
                            <th class="col-phone text-left font-semibold px-4 py-3 cursor-pointer" onclick="sortTable('phone')">Phone <i class="fas fa-sort ml-1"></i></th>
                            <th class="col-qid text-left font-semibold px-4 py-3 cursor-pointer" onclick="sortTable('qid')">Qatar ID <i class="fas fa-sort ml-1"></i></th>
                            <th class="col-status text-center font-semibold px-4 py-3 cursor-pointer" onclick="sortTable('status')">STATUS <i class="fas fa-sort text-gray-400 ml-1"></i></th>
                            <th class="col-position text-left font-semibold px-4 py-3 cursor-pointer" onclick="sortTable('position')">Position <i class="fas fa-sort ml-1"></i></th>
                            <th class="col-company text-left font-semibold px-4 py-3 cursor-pointer whitespace-nowrap" onclick="sortTable('department')">Company <i class="fas fa-sort ml-1"></i></th>
                            <th class="col-salary text-right font-semibold px-4 py-3 cursor-pointer whitespace-nowrap" onclick="sortTable('salary')">Monthly Salary <i class="fas fa-sort ml-1"></i></th>
                            <th class="col-join text-left font-semibold px-4 py-3 cursor-pointer" onclick="sortTable('joinDate')">Join Date <i class="fas fa-sort ml-1"></i></th>
                            <th class="col-actions text-center font-semibold px-0 py-3 cursor-pointer" onclick="sortTable('actions')">Actions <i class="fas fa-sort ml-1"></i></th>
                        </tr>
                    </thead>
                    <tbody id="employeeTableBody" class="divide-y divide-gray-100"></tbody>
                </table>
            </div>
            <div class="empty-state hidden" id="emptyState">
                <div class="empty-state-icon"><i class="fas fa-inbox"></i></div>
                <h3 class="text-lg font-semibold text-gray-700">No Employees Found</h3>
                <p class="text-gray-500">Start by adding your first team member</p>
            </div>
                </div>
    </section>

    <!-- Temporary Employees Section -->
    <section id="temporarySection" data-section="temporary" class="space-y-8" style="display:none;">
        <div class="card overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-100 bg-gray-50"><h3 class="text-lg font-bold text-gray-900">Temporary Employees</h3></div>
            <div class="overflow-x-auto">
                <table class="min-w-full text-sm table-fixed data-table employee-table" aria-label="Temporary Employees">
                                        <style>
                                            /* Visual indicator for terminated temporary employees */
                                            tr.terminated-row { background-color: #fff1f2; }
                                            tr.terminated-row:hover { background-color: #ffe4e6; }
                                            tr.terminated-row > th,
                                            tr.terminated-row > td { background-color: #fff1f2 !important; }
                                            tr.terminated-row:hover > th,
                                            tr.terminated-row:hover > td { background-color: #ffe4e6 !important; }
                                            tr.terminated-row *:not(.expiry-dot):not(.status-dot) { background-color: #fff1f2 !important; }
                                            tr.terminated-row:hover *:not(.expiry-dot):not(.status-dot) { background-color: #ffe4e6 !important; }
                                        </style>
                    <colgroup>
                        <col class="w-[13%]" />  <!-- Name -->
                        <col class="w-[10%]" />  <!-- Email -->
                        <col class="w-[9%]" />   <!-- Phone -->
                        <col class="w-[9%]" />   <!-- Qatar ID -->
                        <col class="w-[6%]" />   <!-- Status -->
                        <col class="w-[18%]" />  <!-- Position -->
                        <col class="w-[11%]" />  <!-- Company -->
                        <col class="w-[11%]" />  <!-- Monthly Salary -->
                        <col class="w-[9%]" />   <!-- Join Date -->
                        <col class="w-[4%]" />   <!-- Actions -->
                    </colgroup>
                    <thead class="bg-gray-50 text-gray-600 text-xs uppercase tracking-wide">
                        <tr>
                            <th scope="col" class="col-name text-center font-semibold px-5 py-4 text-base tracking-wide" onclick="sortTable('name','temporary')">Name <i class="fas fa-sort ml-1 text-sm"></i></th>
                            <th scope="col" class="col-email text-left font-semibold px-5 py-4 text-base tracking-wide" onclick="sortTable('email','temporary')">Email <i class="fas fa-sort ml-1 text-sm"></i></th>
                            <th scope="col" class="col-phone text-center font-semibold px-4 py-4 text-base tracking-wide" onclick="sortTable('phone','temporary')">Phone <i class="fas fa-sort ml-1 text-sm"></i></th>
                            <th scope="col" class="col-qid text-center font-semibold px-4 py-4 text-base tracking-wide" onclick="sortTable('qid','temporary')">Qatar ID <i class="fas a-sort ml-1 text-sm"></i></th>
                            <th scope="col" class="col-status text-center font-semibold px-3 py-4 text-base tracking-wide" onclick="sortTable('status','temporary')">Status <i class="fas fa-sort ml-1 text-sm"></i></th>
                            <th scope="col" class="col-position text-left font-semibold px-4 py-4 text-base tracking-wide" onclick="sortTable('position','temporary')">Position <i class="fas fa-sort ml-1 text-sm"></i></th>
                            <th scope="col" class="col-company text-left font-semibold px-4 py-4 text-base tracking-wide" onclick="sortTable('department','temporary')">Company <i class="fas fa-sort ml-1 text-sm"></i></th>
                            <th scope="col" class="col-salary text-center font-semibold px-4 py-4 text-base tracking-wide" onclick="sortTable('salary','temporary')">Salary <i class="fas fa-sort ml-1 text-sm"></i></th>
                            <th scope="col" class="col-join text-right font-semibold px-4 py-4 text-base tracking-wide" onclick="sortTable('joinDate','temporary')">Join Date <i class="fas fa-sort ml-1 text-sm"></i></th>
                            <th scope="col" class="col-actions text-center font-semibold px-2 py-4 text-base tracking-wide" onclick="sortTable('actions','temporary')">Actions <i class="fas fa-sort ml-1 text-sm"></i></th>
                        </tr>
                    </thead>
                    <tbody id="tempEmployeeTableBody" class="divide-y divide-gray-100"></tbody>
                </table>
            </div>
            <div class="empty-state hidden" id="tempEmptyState">
                <div class="empty-state-icon"><i class="fas fa-inbox"></i></div>
                <h3 class="text-lg font-semibold text-gray-700">No Temporary Employees Found</h3>
                <p class="text-gray-500">Start by adding your first temporary team member</p>
            </div>
        </div>
    </section>
                </main>
            </div>
        </div>

    <!-- Enhanced Delete Modal (simplified, no red gradient square) -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <div class="modal-header flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <i class="fas fa-exclamation-triangle text-rose-600"></i>
                    <h3 class="modal-title">Confirm Deletion</h3>
                </div>
                <button class="btn btn-ghost" aria-label="Close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger">
                    <div class="alert-icon"><i class="fas fa-exclamation"></i></div>
                    <div>
                        <p class="font-semibold">This action cannot be undone.</p>
                        <p class="text-sm opacity-90">The employee record will be permanently removed from the system.</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()"><i class="fas fa-times"></i> Cancel</button>
                <button class="btn btn-danger" id="confirmDelete"><i class="fas fa-trash"></i> Delete Employee</button>
            </div>
        </div>
    </div>

    <!-- Enhanced Employee Form Modal -->
    <div class="modal" id="employeeModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-header-content">
                    <div>
                        <h3 id="formTitle" class="modal-title">Add New Employee</h3>
                        <p class="modal-subtitle">Fill in the details to add a new team member</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-body">
                <form id="employeeForm" class="form-section">
                    <input type="hidden" id="employeeId" />
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="name" class="label">
                                <i class="fas fa-user label-icon"></i>
                                Full Name
                            </label>
                            <input type="text" 
                                   id="name" 
                                   required 
                                   placeholder="e.g., John Smith" 
                                   class="input" />
                            <span class="error-message">Please enter a valid name</span>
                        </div>
                        <div class="form-group">
                            <label for="email" class="label">
                                <i class="fas fa-envelope label-icon"></i>
                                Email Address
                            </label>
                            <input type="email" 
                                   id="email" 
                                   required 
                                   placeholder="john.smith@company.com" 
                                   class="input" />
                            <span class="error-message">Please enter a valid email</span>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="position" class="label">
                                <i class="fas fa-briefcase label-icon"></i>
                                Job Position
                            </label>
                            <input type="text" 
                                   id="position" 
                                   required 
                                   placeholder="e.g., Software Engineer" 
                                   class="input" />
                            <span class="error-message">Please enter a position</span>
                        </div>
                        <div class="form-group">
                            <label for="department" class="label">
                                <i class="fas fa-building label-icon"></i>
                                Company
                            </label>
                            <input type="text"
                    id="department"
                                   required
                    placeholder="e.g., Acme Contracting"
                                   class="input" />
                <span class="error-message">Please enter a company</span>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="salary" class="label">
                                <i class="fas fa-dollar-sign label-icon"></i>
                                Monthly Salary
                            </label>
                <input type="number" 
                    id="salary" 
                    required 
                    step="any"
                    placeholder="5000" 
                    class="input" />
                            <span class="error-message">Please enter a valid salary</span>
                        </div>
                        <div class="form-group">
                            <label for="joinDate" class="label">
                                <i class="fas fa-calendar label-icon"></i>
                                Start Date
                            </label>
                            <input type="date" 
                                   id="joinDate" 
                                   required 
                                   class="input" />
                            <span class="error-message">Please select a join date</span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="qid" class="label">
                                <i class="fas fa-id-card label-icon"></i>
                                Qatar ID Number
                            </label>
                            <input type="text"
                                   id="qid"
                                   inputmode="numeric"
                                   pattern="[0-9]*"
                                   placeholder="e.g., 12345678901"
                                   class="input" />
                            <span class="error-message">Qatar ID should be digits only</span>
                        </div>
                        <div class="form-group">
                            <label for="phone" class="label">
                                <i class="fas fa-phone label-icon"></i>
                                Phone Number
                            </label>
                            <input type="tel"
                                   id="phone"
                                   placeholder="e.g., +974 5555 1234"
                                   class="input" />
                            <span class="error-message">Please enter a valid phone number</span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="qidExpiry" class="label">
                                <i class="fas fa-calendar-times label-icon"></i>
                                Qatar ID Expiry Date
                            </label>
                            <input type="date" id="qidExpiry" class="input" />
                        </div>
                        <div class="form-group">
                            <label for="passportExpiry" class="label">
                                <i class="fas fa-passport label-icon"></i>
                                Passport Expiry Date
                            </label>
                            <input type="date" id="passportExpiry" class="input" />
                        </div>
                    </div>

                    <!-- Bank details -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="bankName" class="label">
                                <i class="fas fa-university label-icon"></i>
                                Bank Name
                            </label>
                            <input type="text"
                                   id="bankName"
                                   placeholder="e.g., Qatar National Bank"
                                   class="input" />
                            <span class="error-message">Please enter a valid bank name</span>
                        </div>
                        <div class="form-group">
                            <label for="bankAccountNumber" class="label">
                                <i class="fas fa-hashtag label-icon"></i>
                                Account Number
                            </label>
                            <input type="text"
                                   id="bankAccountNumber"
                                   inputmode="numeric"
                                   placeholder="e.g., 1234567890"
                                   class="input" />
                            <span class="error-message">Please enter a valid account number</span>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group md:col-span-2">
                            <label for="bankIban" class="label">
                                <i class="fas fa-globe label-icon"></i>
                                IBAN
                            </label>
                            <input type="text"
                                   id="bankIban"
                                   placeholder="e.g., QA58 DOHB 0000 1234 5678 90AB CDEF G"
                                   class="input" />
                            <span class="error-message">Please enter a valid IBAN</span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="label">
                                <i class="fas fa-image label-icon"></i>
                                Profile Image
                            </label>
                            <input type="file" id="profileImage" accept="image/png,image/jpeg,image/webp" class="input" />
                            <div class="mt-2 flex gap-2">
                                <span id="profileImageStatus" class="text-xs text-gray-500"></span>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="label">
                                <i class="fas fa-file-pdf label-icon"></i>
                                Qatar ID PDF
                            </label>
                            <input type="file" id="qidPdf" accept="application/pdf" class="input" />
                            <div class="mt-2 flex gap-2">
                                <span id="qidPdfStatus" class="text-xs text-gray-500"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="label">
                                <i class="fas fa-passport label-icon"></i>
                                Passport PDF
                            </label>
                            <input type="file" id="passportPdf" accept="application/pdf" class="input" />
                            <div class="mt-2 flex gap-2">
                                <span id="passportPdfStatus" class="text-xs text-gray-500"></span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeEmployeeModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="submit" 
                        form="employeeForm" 
                        class="btn btn-primary btn-lg">
                    <i class="fas fa-save"></i> Save Employee
                </button>
            </div>
        </div>
    </div>

    <!-- Employee Details Modal (Accordion-based, accessible) -->
    <div class="modal" id="viewModal" role="dialog" aria-modal="true" aria-labelledby="viewModalTitle" aria-describedby="viewNameSub">
        <div class="modal-content md:max-w-5xl lg:max-w-6xl w-full max-w-[98vw]" tabindex="-1">
            <div class="modal-header flex items-center justify-between">
                <div class="modal-header-content">
                    <div>
                        <h3 class="modal-title" id="viewModalTitle">Employee Details</h3>
                        <p class="modal-subtitle" id="viewNameSub">&nbsp;</p>
                    </div>
                </div>
                <button class="btn btn-ghost" aria-label="Close" id="viewCloseIcon"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body space-y-4">
                <!-- Overview Section -->
                <section class="card overflow-hidden" aria-labelledby="acc-overview-h">
                    <button class="w-full flex items-center justify-between px-6 py-2 text-left hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-200" data-acc-toggle data-acc-target="#acc-overview">
                        <div class="flex items-center gap-2">
                            <i class="fas fa-user-circle text-indigo-500"></i>
                            <h4 id="acc-overview-h" class="text-sm font-bold text-gray-800">Overview</h4>
                        </div>
                        <i class="fas fa-chevron-down text-gray-400" aria-hidden="true"></i>
                    </button>
                    <div id="acc-overview" class="px-6 pt-6 pb-6">
                        <div class="flex flex-col md:flex-row items-start md:items-center gap-4">
                            <div class="relative">
                                <div class="rounded-full p-1 bg-gradient-to-br from-gray-200 via-gray-300 to-gray-400 border border-gray-400 shadow-sm">
                                    <img id="viewProfileImageLarge" class="w-[220px] h-[220px] rounded-full object-cover hidden" alt="Profile image" />
                                    <div id="viewProfilePlaceholderLarge" class="w-[220px] h-[220px] rounded-full bg-gradient-to-br from-indigo-100 via-white to-purple-100 text-indigo-400 flex items-center justify-center">
                                        <i class="fas fa-user text-5xl"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="min-w-0 flex-1">
                                <div id="viewNameDisplay" class="text-lg md:text-xl font-extrabold text-gray-900">&nbsp;</div>
                                <div id="viewNameSubDisplay" class="text-sm text-gray-600">&nbsp;</div>
                                <div class="flex items-center gap-2 mt-3 flex-wrap">
                                    <span id="viewDepartmentChip" class="px-2 py-0.5 rounded text-xs font-semibold bg-gray-100 text-gray-700">&nbsp;</span>
                                    <span id="viewTypeChip" class="px-2 py-0.5 rounded text-xs font-semibold bg-emerald-100 text-emerald-800">&nbsp;</span>
                                </div>
                                <!-- Stats: Join date, Salary, Attendance, Rating -->
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
                                    <div>
                                        <div class="text-xs text-gray-500">Start Date</div>
                                        <div id="viewJoinDate" class="text-gray-900 font-semibold">&nbsp;</div>
                                    </div>
                                    <div>
                                        <div class="text-xs text-gray-500">Monthly Salary</div>
                                        <div id="viewSalary" class="text-gray-900 font-semibold tabular-nums">&nbsp;</div>
                                    </div>
                                    <div>
                                        <div class="text-xs text-gray-500">Qatar ID Expiry</div>
                                        <div id="viewQidExpiryShort" class="text-gray-900 font-semibold">&nbsp;</div>
                                    </div>
                                    <div>
                                        <div class="text-xs text-gray-500">Passport Expiry</div>
                                        <div id="viewPassportExpiryShort" class="text-gray-900 font-semibold">&nbsp;</div>
                                    </div>
                                    <div id="viewAttendanceWrap" class="hidden">
                                        <div class="text-xs text-gray-500">Attendance</div>
                                        <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                                            <div id="viewAttendanceBar" class="h-full bg-indigo-500" style="width:0%"></div>
                                        </div>
                                        <div id="viewAttendanceLabel" class="text-xs text-gray-600 mt-1">&nbsp;</div>
                                    </div>
                                    <div id="viewRatingWrap" class="hidden">
                                        <div class="text-xs text-gray-500">Rating</div>
                                        <div id="viewRatingStars" class="flex items-center gap-1" aria-label="Rating"></div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </section>

                <!-- Contact & Personal -->
                <section class="card overflow-hidden" aria-labelledby="acc-contact-h">
                    <button class="w-full flex items-center justify-between px-6 py-2 text-left hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-200" data-acc-toggle data-acc-target="#acc-contact">
                        <div class="flex items-center gap-2">
                            <i class="fas fa-address-card text-indigo-500"></i>
                            <h4 id="acc-contact-h" class="text-sm font-bold text-gray-800">Contact & Personal</h4>
                        </div>
                        <i class="fas fa-chevron-down text-gray-400" aria-hidden="true"></i>
                    </button>
                    <div id="acc-contact" class="px-6 pt-6 pb-6 hidden">
                        <dl class="space-y-2">
                            <div class="grid grid-cols-[200px_1fr] md:grid-cols-[260px_1fr] items-start gap-2">
                                <dt class="text-xs font-semibold uppercase tracking-wider text-gray-500 flex items-center gap-2"><i class="fas fa-user text-indigo-500"></i> Full Name</dt>
                                <dd id="viewName" class="text-gray-900 font-semibold truncate">&nbsp;</dd>
                            </div>
                            <div class="grid grid-cols-[200px_1fr] md:grid-cols-[260px_1fr] items-start gap-2">
                                <dt class="text-xs font-semibold uppercase tracking-wider text-gray-500 flex items-center gap-2"><i class="fas fa-envelope text-indigo-500"></i> Email</dt>
                                <dd id="viewEmail" class="text-gray-900 break-all">&nbsp;</dd>
                            </div>
                            <div class="grid grid-cols-[200px_1fr] md:grid-cols-[260px_1fr] items-start gap-2">
                                <dt class="text-xs font-semibold uppercase tracking-wider text-gray-500 flex items-center gap-2"><i class="fas fa-phone text-indigo-500"></i> Phone</dt>
                                <dd id="viewPhone" class="text-gray-900">&nbsp;</dd>
                            </div>
                            <div class="grid grid-cols-[200px_1fr] md:grid-cols-[260px_1fr] items-start gap-2">
                                <dt class="text-xs font-semibold uppercase tracking-wider text-gray-500 flex items-center gap-2"><i class="fas fa-id-card text-indigo-500"></i> Qatar ID</dt>
                                <dd id="viewQid" class="text-gray-900 tabular-nums">&nbsp;</dd>
                            </div>
                            <div class="grid grid-cols-[200px_1fr] md:grid-cols-[260px_1fr] items-start gap-2">
                                <dt class="text-xs font-semibold uppercase tracking-wider text-gray-500 flex items-center gap-2"><i class="fas fa-calendar-times text-indigo-500"></i> Qatar ID Expiry</dt>
                                <dd id="viewQidExpiry" class="text-gray-900">&nbsp;</dd>
                            </div>
                            <div class="grid grid-cols-[200px_1fr] md:grid-cols-[260px_1fr] items-start gap-2">
                                <dt class="text-xs font-semibold uppercase tracking-wider text-gray-500 flex items-center gap-2"><i class="fas fa-passport text-indigo-500"></i> Passport Expiry</dt>
                                <dd id="viewPassportExpiry" class="text-gray-900">&nbsp;</dd>
                            </div>
                        </dl>
                    </div>
                </section>

                <!-- Employment Details -->
                <section class="card overflow-hidden" aria-labelledby="acc-employment-h">
                    <button class="w-full flex items-center justify-between px-6 py-2 text-left hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-200" data-acc-toggle data-acc-target="#acc-employment">
                        <div class="flex items-center gap-2">
                            <i class="fas fa-briefcase text-indigo-500"></i>
                            <h4 id="acc-employment-h" class="text-sm font-bold text-gray-800">Employment Details</h4>
                        </div>
                        <i class="fas fa-chevron-down text-gray-400" aria-hidden="true"></i>
                    </button>
                    <div id="acc-employment" class="px-6 pt-6 pb-6 hidden">
                        <dl class="space-y-2">
                            <div class="grid grid-cols-[200px_1fr] md:grid-cols-[260px_1fr] items-start gap-2">
                                <dt class="text-xs font-semibold uppercase tracking-wider text-gray-500 flex items-center gap-2"><i class="fas fa-briefcase text-indigo-500"></i> Position</dt>
                                <dd id="viewPosition" class="text-gray-900">&nbsp;</dd>
                            </div>
                            <div class="grid grid-cols-[200px_1fr] md:grid-cols-[260px_1fr] items-start gap-2">
                                <dt class="text-xs font-semibold uppercase tracking-wider text-gray-500 flex items-center gap-2"><i class="fas fa-layer-group text-indigo-500"></i> Company</dt>
                                <dd id="viewDepartment" class="text-gray-900">&nbsp;</dd>
                            </div>
                            <div class="hidden"> <!-- Keep for backward compatibility if referenced -->
                                <img id="viewProfileImage" class="w-16 h-16 rounded-md object-cover border border-gray-200 hidden" alt="Profile Image" />
                                <div id="viewProfilePlaceholder" class="w-16 h-16 rounded-md bg-gray-100 text-gray-400 flex items-center justify-center">
                                    <i class="fas fa-user text-xl"></i>
                                </div>
                            </div>
                        </dl>
                    </div>
                </section>

                <!-- Bank Details -->
                <section class="card overflow-hidden" aria-labelledby="acc-bank-h">
                    <button class="w-full flex items-center justify-between px-6 py-2 text-left hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-200" data-acc-toggle data-acc-target="#acc-bank">
                        <div class="flex items-center gap-2">
                            <i class="fas fa-university text-indigo-500"></i>
                            <h4 id="acc-bank-h" class="text-sm font-bold text-gray-800">Bank Details</h4>
                        </div>
                        <i class="fas fa-chevron-down text-gray-400" aria-hidden="true"></i>
                    </button>
                    <div id="acc-bank" class="px-6 pt-6 pb-6 hidden">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <dl class="space-y-1">
                                <dt class="text-xs font-semibold uppercase tracking-wider text-gray-500">Bank Name</dt>
                                <dd id="viewBankName" class="text-gray-900">&nbsp;</dd>
                            </dl>
                            <dl class="space-y-1">
                                <dt class="text-xs font-semibold uppercase tracking-wider text-gray-500">Account Number</dt>
                                <dd id="viewAccountNumber" class="text-gray-900 tabular-nums">&nbsp;</dd>
                            </dl>
                            <dl class="space-y-1">
                                <dt class="text-xs font-semibold uppercase tracking-wider text-gray-500">IBAN</dt>
                                <dd id="viewIban" class="text-gray-900 break-all">&nbsp;</dd>
                            </dl>
                        </div>
                    </div>
                </section>

                <!-- Documents & Actions -->
                <section class="card overflow-hidden" aria-labelledby="acc-docs-h">
                    <button class="w-full flex items-center justify-between px-6 py-2 text-left hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-200" data-acc-toggle data-acc-target="#acc-docs" id="docsSectionHeader">
                        <div class="flex items-center gap-2">
                            <i class="fas fa-folder-open text-indigo-500"></i>
                            <h4 id="acc-docs-h" class="text-sm font-bold text-gray-800">Documents & Actions</h4>
                        </div>
                        <i class="fas fa-chevron-down text-gray-400" aria-hidden="true"></i>
                    </button>
                    <div id="acc-docs" class="px-6 pt-6 pb-6 hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="card p-6">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="text-sm font-bold text-gray-800 flex items-center gap-2"><i class="fas fa-file-pdf text-rose-500"></i> Qatar ID PDF</h4>
                                    <a id="qidPdfLink" href="#" target="_blank" class="btn btn-ghost" style="display:none;"><i class="fas fa-external-link-alt"></i> Open</a>
                                </div>
                                <div id="qidDocEmpty" class="text-gray-500 text-sm">No document uploaded</div>
                                <div id="qidLoading" class="text-gray-400 text-sm" style="display:none;">Loading…</div>
                                <iframe id="qidPdfPreview" style="display:none; width:100%; height:480px; border:1px solid #e5e7eb; border-radius: 0.5rem;" title="Qatar ID PDF Preview"></iframe>
                            </div>
                            <div class="card p-6">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="text-sm font-bold text-gray-800 flex items-center gap-2"><i class="fas fa-passport text-indigo-500"></i> Passport PDF</h4>
                                    <a id="passportPdfLink" href="#" target="_blank" class="btn btn-ghost" style="display:none;"><i class="fas fa-external-link-alt"></i> Open</a>
                                </div>
                                <div id="passportDocEmpty" class="text-gray-500 text-sm">No document uploaded</div>
                                <div id="passportLoading" class="text-gray-400 text-sm" style="display:none;">Loading…</div>
                                <iframe id="passportPdfPreview" style="display:none; width:100%; height:480px; border:1px solid #e5e7eb; border-radius: 0.5rem;" title="Passport PDF Preview"></iframe>
                            </div>
                        </div>
                    </div>
                </section>

                
            </div>
            <!-- Prominent Action Bar -->
            <div class="modal-footer sticky bottom-0 bg-white/80 backdrop-blur border-t border-gray-100 flex items-center justify-between gap-3">
                <div class="text-sm text-gray-500 px-1">Press Esc to close • Tab to navigate</div>
                <div class="flex items-center gap-2">
                    <span id="viewTerminatedBadge" class="px-2 py-0.5 rounded text-xs font-semibold bg-rose-100 text-rose-800 hidden"><i class="fas fa-user-slash"></i> Terminated</span>
                    <button type="button" class="btn btn-secondary" id="viewActionClose"><i class="fas fa-times"></i> Close</button>
                    <button type="button" class="btn btn-primary" id="viewActionEdit"><i class="fas fa-pen"></i> Edit</button>
                    <button type="button" class="btn btn-danger" id="viewActionTerminate"><i class="fas fa-user-slash"></i> Terminate</button>
                    <button type="button" class="btn btn-primary" id="viewActionReinstate" style="display:none;"><i class="fas fa-undo"></i> Reinstate</button>
                    <button type="button" class="btn btn-danger" id="viewActionDelete"><i class="fas fa-trash"></i> Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Payroll Detail Modal -->
    <div class="modal" id="payrollModal" role="dialog" aria-modal="true" aria-labelledby="payrollModalTitle">
        <div class="modal-content w-[98vw] max-w-[1400px] max-h-[80vh] overflow-y-auto rounded-none">
            <div class="modal-header flex items-center justify-between rounded-none">
                <div class="flex items-center gap-3">
                    <i class="fas fa-file-invoice-dollar text-indigo-600"></i>
                    <h3 id="payrollModalTitle" class="modal-title">Payroll Details</h3>
                </div>
                <button class="btn btn-ghost" aria-label="Close" onclick="closePayrollModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <!-- Tabs header -->
                <div class="border-b mb-3">
                    <div class="flex items-center gap-2">
                        <button id="payrollViewTabOverviewBtn" class="px-3 py-2 rounded-t-md font-semibold text-indigo-600 border-b-2 border-indigo-600">Overview</button>
                        <button id="payrollViewTabPayslipsBtn" class="px-3 py-2 rounded-t-md text-gray-600 hover:text-gray-800">Payslips</button>
                    </div>
                </div>

                <!-- Tab: Overview -->
                <div id="payrollViewTabOverview" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="card p-4">
                        <div class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Employee</div>
                        <div class="text-lg font-bold text-gray-900" id="payrollViewName">—</div>
                        <div class="text-sm text-gray-600" id="payrollViewType">—</div>
                    </div>
                    <div class="card p-4">
                        <div class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Compensation</div>
                        <div class="flex items-center justify-between"><span class="text-gray-600">Monthly Salary</span><span class="font-semibold" id="payrollViewSalary">—</span></div>
                        <div class="flex items-center justify-between"><span class="text-gray-600">Start Date</span><span class="font-semibold" id="payrollViewJoinDate">—</span></div>
                    </div>
                    <div class="card p-4">
                        <div class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Employment</div>
                        <div class="flex items-center justify-between"><span class="text-gray-600">Company</span><span class="font-semibold" id="payrollViewDepartment">—</span></div>
                        <div class="flex items-center justify-between"><span class="text-gray-600">Position</span><span class="font-semibold" id="payrollViewPosition">—</span></div>
                        <div class="flex items-center justify-between"><span class="text-gray-600">Qatar ID</span><span class="font-semibold" id="payrollViewQid">—</span></div>
                    </div>
                    <div class="card p-4">
                        <div class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Bank</div>
                        <div class="flex items-center justify-between"><span class="text-gray-600">Bank Name</span><span class="font-semibold" id="payrollViewBankName">—</span></div>
                        <div class="flex items-center justify-between"><span class="text-gray-600">Account</span><span class="font-semibold" id="payrollViewAccount">—</span></div>
                        <div class="flex items-center justify-between"><span class="text-gray-600">IBAN</span><span class="font-semibold break-all" id="payrollViewIban">—</span></div>
                    </div>
                </div>

                <!-- Tab: Payslips -->
                <div id="payrollViewTabPayslips" class="space-y-4" style="display:none;">
                    <!-- Advance Payslips -->
                    <div class="card p-4">
                        <div class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-3">Advance Payslips</div>
                        <div id="payrollPayslipsAdvLoading" class="text-gray-400 text-sm" style="display:none;">Loading…</div>
                        <div id="payrollPayslipsAdvEmpty" class="text-gray-500 text-sm">No advance payslips yet</div>
                        <div id="payrollPayslipsAdvList" class="mt-2 space-y-2"></div>
                    </div>
                    <!-- Salary Payslips (from Salary Payments) -->
                    <div class="card p-4">
                        <div class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-3">Salary Payslips</div>
                        <div id="payrollPayslipsSalLoading" class="text-gray-400 text-sm" style="display:none;">Loading…</div>
                        <div id="payrollPayslipsSalEmpty" class="text-gray-500 text-sm">No salary payslips yet</div>
                        <div id="payrollPayslipsSalList" class="mt-2 space-y-2"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer flex items-center justify-end gap-2 rounded-none">
                <button type="button" class="btn btn-secondary" onclick="closePayrollModal()"><i class="fas fa-times"></i> Close</button>
            </div>
        </div>
    </div>

    <!-- Hidden print area populated dynamically for payslip printing -->
    <div id="payslipPrintArea" aria-hidden="true"></div>
    <!-- Global backdrop scrim (activated via body.modal-open) -->
    <div class="backdrop" id="globalBackdrop" aria-hidden="true"></div>

    <!-- Payslip Form Modal -->
    <div class="modal" id="payslipModal" role="dialog" aria-modal="true" aria-labelledby="payslipModalTitle">
        <div class="modal-content max-w-xl w-full">
            <div class="modal-header flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <i class="fas fa-receipt text-indigo-600"></i>
                    <h3 id="payslipModalTitle" class="modal-title">Generate Payslip</h3>
                </div>
                <button class="btn btn-ghost" aria-label="Close" onclick="closePayslipModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="payslipForm" class="space-y-4">
                    <div class="grid grid-cols-1 gap-4">
                        <div>
                            <label class="label"><i class="fas fa-user label-icon"></i> Employee</label>
                            <input id="psEmployeeName" type="text" class="input" readonly />
                            <input id="psEmployeeType" type="text" class="input mt-2" readonly />
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="label"><i class="fas fa-calendar-alt label-icon"></i> Pay Period</label>
                                <input id="psPeriod" type="month" class="input" required />
                            </div>
                            <div>
                                <label class="label"><i class="fas fa-dollar-sign label-icon"></i> Basic Salary</label>
                                <input id="psBasic" type="number" step="any" class="input" required readonly title="Basic salary is set from the employee record" style="background-color:#f9fafb; cursor:not-allowed;" />
                            </div>
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-sack-dollar label-icon"></i> Advance Amount</label>
                            <input id="psAdvanceAmount" type="number" step="any" class="input" value="0" required />
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-sticky-note label-icon"></i> Notes (optional)</label>
                            <textarea id="psNotes" class="input" rows="3" placeholder="Notes to include on the payslip..."></textarea>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded border border-gray-200">
                            <div class="text-sm text-gray-600">Advance Amount</div>
                            <div id="psNet" class="text-lg font-extrabold text-gray-900">$0.00</div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer flex items-center justify-end gap-2">
                <button type="button" class="btn btn-secondary" onclick="closePayslipModal()"><i class="fas fa-times"></i> Cancel</button>
                <button type="button" class="btn btn-primary" id="payslipPrintBtn"><i class="fas fa-print"></i> Print Payslip</button>
            </div>
        </div>
    </div>

    <!-- Salary Payment Form Modal (for advances/partial payments) -->
    <div class="modal" id="paymentModal" role="dialog" aria-modal="true" aria-labelledby="paymentModalTitle">
    <div class="modal-content w-[95vw] max-w-[1200px]" style="width:95vw; max-width:1200px;">
            <div class="modal-header flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <i class="fas fa-cash-register text-indigo-600"></i>
                    <h3 id="paymentModalTitle" class="modal-title">Pay Salary</h3>
                </div>
                <button class="btn btn-ghost" aria-label="Close" onclick="closePaymentModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="paymentForm" class="space-y-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="label"><i class="fas fa-user label-icon"></i> Employee</label>
                            <input id="payEmployeeName" type="text" class="input" readonly />
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-id-badge label-icon"></i> Type</label>
                            <input id="payEmployeeType" type="text" class="input" readonly />
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-end">
                        <div>
                            <label class="label"><i class="fas fa-calendar-day label-icon"></i> Payment Date</label>
                            <input id="payDate" type="date" class="input" required />
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-dollar-sign label-icon"></i> Amount</label>
                            <input id="payAmount" type="number" step="any" class="input" required />
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-end">
                        <div>
                            <label class="label"><i class="fas fa-business-time label-icon"></i> Overtime Amount (optional)</label>
                            <input id="payOvertime" type="number" step="any" class="input" placeholder="e.g., 250" />
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-clock label-icon"></i> Overtime Hours (optional)</label>
                            <input id="payOvertimeHours" type="number" step="any" class="input" placeholder="e.g., 6" />
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-end">
                        <div>
                            <label class="label"><i class="fas fa-wallet label-icon"></i> Payment Method</label>
                            <select id="payMethod" class="input">
                                <option value="cash">Cash</option>
                                <option value="bank">Bank Transfer</option>
                                <option value="cheque">Cheque</option>
                            </select>
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-file-signature label-icon"></i> Reference (optional)</label>
                            <input id="payRef" type="text" class="input" placeholder="Txn/cheque no." />
                        </div>
                        <div class="md:col-span-2">
                            <label class="label"><i class="fas fa-undo label-icon"></i> Deduct From</label>
                            <select id="payDeductFrom" class="input">
                                <option value="none">Do not deduct</option>
                                <option value="next">Next payroll</option>
                                <option value="installments">Split over 3 months</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="label"><i class="fas fa-sticky-note label-icon"></i> Notes (optional)</label>
                        <textarea id="payNotes" class="input" rows="3" placeholder="Salary payment notes..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer flex items-center justify-end gap-2">
                <button type="button" class="btn btn-secondary" onclick="closePaymentModal()"><i class="fas fa-times"></i> Cancel</button>
                <button type="button" class="btn btn-primary" id="paymentPrintBtn"><i class="fas fa-print"></i> Print Salary Slip</button>
            </div>
        </div>
    </div>

    <!-- Payslip Preview Modal (view the payslip template) -->
    <div class="modal" id="payslipPreviewModal" role="dialog" aria-modal="true" aria-labelledby="payslipPreviewTitle">
        <div class="modal-content max-w-3xl w-full">
            <div class="modal-header flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <i class="fas fa-file-alt text-indigo-600"></i>
                    <h3 id="payslipPreviewTitle" class="modal-title">Payslip Preview</h3>
                </div>
                <button class="btn btn-ghost" aria-label="Close" onclick="closePayslipPreviewModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="payslipPreviewContent" class="bg-white border border-gray-200 rounded-md p-4 overflow-auto" style="max-height:65vh;"></div>
            </div>
            <div class="modal-footer flex items-center justify-end gap-2">
                <button type="button" class="btn btn-secondary" onclick="closePayslipPreviewModal()"><i class="fas fa-times"></i> Close</button>
                <button type="button" class="btn btn-primary" id="payslipPreviewPrintBtn"><i class="fas fa-print"></i> Print</button>
            </div>
        </div>
    </div>

    <!-- Client Form Modal -->
    <div class="modal" id="clientModal" role="dialog" aria-modal="true" aria-labelledby="clientModalTitle">
        <div class="modal-content max-w-xl w-full">
            <div class="modal-header flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <i class="fas fa-handshake text-indigo-600"></i>
                    <h3 id="clientModalTitle" class="modal-title">Add Client</h3>
                </div>
                <button class="btn btn-ghost" aria-label="Close" onclick="closeClientModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="clientForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="label"><i class="fas fa-building label-icon"></i> Company Name</label>
                            <input id="clientName" type="text" class="input" required placeholder="e.g., Acme LLC" />
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-envelope label-icon"></i> Company Email</label>
                            <input id="clientEmail" type="email" class="input" required placeholder="info@acme.com" />
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="label"><i class="fas fa-phone label-icon"></i> Company Phone (optional)</label>
                            <input id="clientPhone" type="tel" class="input" placeholder="e.g., +974 5555 1234" />
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-user-tie label-icon"></i> Contact Person (optional)</label>
                            <input id="clientCompany" type="text" class="input" placeholder="e.g., Jane Doe" />
                        </div>
                    </div>
                    <div>
                        <label class="label"><i class="fas fa-map-marker-alt label-icon"></i> Address</label>
                        <input id="clientAddress" type="text" class="input" placeholder="e.g., Street, City, Country" required />
                    </div>
                    <div>
                        <label class="label"><i class="fas fa-dollar-sign label-icon"></i> Monthly Pay</label>
                        <input id="clientMonthly" type="number" step="any" min="0" class="input" placeholder="e.g., 5000" required />
                        <p class="text-xs text-gray-500 mt-1">Enter 0 to use the total of this client's monthly assignments. Any positive value overrides.</p>
                    </div>
                </form>
            </div>
            <div class="modal-footer flex items-center justify-end gap-2">
                <button type="button" class="btn btn-secondary" onclick="closeClientModal()"><i class="fas fa-times"></i> Cancel</button>
                <button type="submit" form="clientForm" class="btn btn-primary"><i class="fas fa-save"></i> Save Client</button>
            </div>
        </div>
    </div>

    <!-- Client View Modal -->
    <div class="modal" id="clientViewModal" role="dialog" aria-modal="true" aria-labelledby="clientViewModalTitle">
        <div class="modal-content max-w-3xl w-full">
            <div class="modal-header flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <i class="fas fa-building text-indigo-600"></i>
                    <h3 id="clientViewModalTitle" class="modal-title">Client Details</h3>
                </div>
                <button class="btn btn-ghost" aria-label="Close" onclick="closeClientViewModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="card p-4">
                        <div class="text-xs uppercase text-gray-500 font-semibold mb-2">Company</div>
                        <div class="text-lg font-bold text-gray-900" id="cvName">—</div>
                        <div class="text-sm text-gray-600" id="cvCompany">—</div>
                    </div>
                    <div class="card p-4">
                        <div class="text-xs uppercase text-gray-500 font-semibold mb-2">Contact</div>
                        <div class="flex items-center justify-between"><span class="text-gray-600">Email</span><span class="font-semibold break-all" id="cvEmail">—</span></div>
                        <div class="flex items-center justify-between"><span class="text-gray-600">Phone</span><span class="font-semibold" id="cvPhone">—</span></div>
                    </div>
                    <div class="card p-4">
                        <div class="text-xs uppercase text-gray-500 font-semibold mb-2">Address</div>
                        <div class="text-sm text-gray-700" id="cvAddress">—</div>
                    </div>
                    <div class="card p-4">
                        <div class="text-xs uppercase text-gray-500 font-semibold mb-2">Summary</div>
                        <div class="flex items-center justify-between"><span class="text-gray-600">Monthly</span><span class="font-semibold" id="cvMonthly">$0</span></div>
                        <div class="flex items-center justify-between"><span class="text-gray-600">Assigned Employees</span><span class="font-semibold" id="cvAssigned">0</span></div>
                        <div class="flex items-center justify-between"><span class="text-gray-600">Created</span><span class="font-semibold" id="cvCreatedAt">—</span></div>
                    </div>
                </div>
                <div class="card p-4">
                    <div class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Active Assignments</div>
                    <div id="cvAssignmentsEmpty" class="text-sm text-gray-500">No active assignments</div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full table-fixed text-sm" id="cvAssignmentsTable" style="display:none;">
                            <colgroup>
                                <col class="w-[28%]" />
                                <col class="w-[18%]" />
                                <col class="w-[18%]" />
                                <col class="w-[18%]" />
                                <col class="w-[18%]" />
                            </colgroup>
                            <thead class="bg-gray-50 text-gray-600 text-xs uppercase tracking-wide">
                                <tr>
                                    <th class="text-left font-semibold px-4 py-3">Employee</th>
                                    <th class="text-left font-semibold px-4 py-3">Start</th>
                                    <th class="text-left font-semibold px-4 py-3">End</th>
                                    <th class="text-left font-semibold px-4 py-3">Rate</th>
                                    <th class="text-left font-semibold px-4 py-3">Notes</th>
                                </tr>
                            </thead>
                            <tbody id="cvAssignmentsBody" class="divide-y divide-gray-100"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer flex items-center justify-end gap-2">
                <button type="button" class="btn btn-secondary" onclick="closeClientViewModal()"><i class="fas fa-times"></i> Close</button>
            </div>
        </div>
    </div>

    <!-- Assignment Modal -->
    <div class="modal" id="assignmentModal" role="dialog" aria-modal="true" aria-labelledby="assignmentModalTitle">
        <div class="modal-content max-w-xl w-full">
            <div class="modal-header flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <i class="fas fa-people-arrows text-indigo-600"></i>
                    <h3 id="assignmentModalTitle" class="modal-title">Assign Employee to Client</h3>
                </div>
                <button class="btn btn-ghost" aria-label="Close" onclick="closeAssignmentModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="assignmentForm" class="space-y-4">
                    <div>
                        <label class="label"><i class="fas fa-user label-icon"></i> Employee</label>
                        <input id="asEmployee" type="text" class="input" placeholder="Type Qatar ID…" required />
                    </div>
                    <div>
                        <label class="label"><i class="fas fa-building label-icon"></i> Client</label>
                        <select id="asClient" class="input" required></select>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="label"><i class="fas fa-calendar-plus label-icon"></i> Start Date</label>
                            <input id="asStart" type="date" class="input" required />
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-calendar-minus label-icon"></i> End Date (optional)</label>
                            <input id="asEnd" type="date" class="input" />
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="label"><i class="fas fa-dollar-sign label-icon"></i> Rate</label>
                            <input id="asRate" type="number" step="any" class="input" placeholder="e.g., 120" />
                        </div>
                        <div>
                            <label class="label"><i class="fas fa-clock label-icon"></i> Rate Type</label>
                            <select id="asRateType" class="input">
                                <option value="hourly">Hourly</option>
                                <option value="daily">Daily</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="label"><i class="fas fa-sticky-note label-icon"></i> Notes (optional)</label>
                        <textarea id="asNotes" class="input" rows="3" placeholder="Assignment notes..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer flex items-center justify-end gap-2">
                <button type="button" class="btn btn-secondary" onclick="closeAssignmentModal()"><i class="fas fa-times"></i> Cancel</button>
                <button type="submit" form="assignmentForm" class="btn btn-primary"><i class="fas fa-save"></i> Save Assignment</button>
            </div>
        </div>
    </div>

    <script type="module" src="script.js?v=20251005-09"></script>
</body>
</html>
